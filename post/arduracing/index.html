<!doctype html><html class=no-js lang=it>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Arduracing - Luccalug</title>
<script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script>
<meta name=description content>
<meta property="og:title" content="Arduracing">
<meta property="og:description" content="Arduracing è un progetto che aspira alla creazione di una robot car in grado di muoversi autonomamente all’ interno di un circuito.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.luccalug.it/post/arduracing/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2020-01-21T20:48:01+01:00">
<meta property="article:modified_time" content="2020-01-21T20:48:01+01:00">
<meta itemprop=name content="Arduracing">
<meta itemprop=description content="Arduracing è un progetto che aspira alla creazione di una robot car in grado di muoversi autonomamente all’ interno di un circuito."><meta itemprop=datePublished content="2020-01-21T20:48:01+01:00">
<meta itemprop=dateModified content="2020-01-21T20:48:01+01:00">
<meta itemprop=wordCount content="1735">
<meta itemprop=keywords content="arduino,">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Arduracing">
<meta name=twitter:description content="Arduracing è un progetto che aspira alla creazione di una robot car in grado di muoversi autonomamente all’ interno di un circuito.">
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link rel=dns-prefetch href=//fonts.googleapis.com>
<link rel=dns-prefetch href=//fonts.gstatic.com>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
<link rel=stylesheet href=/css/style.css>
<link rel="shortcut icon" href=/favicon.ico>
</head>
<body class=body>
<div class="container container--outer">
<header class=header>
<div class="container header__container">
<div class="logo logo--mixed">
<a class=logo__link href=/ title=Luccalug rel=home>
<div class="logo__item logo__imagebox">
<img class=logo__img src=/img/luccalug.png>
</div><div class="logo__item logo__text">
<div class=logo__title>Luccalug</div>
<div class=logo__tagline>Lucca Linux user group</div>
</div>
</a>
</div>
<nav class=menu>
<button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span>
</button>
<ul class=menu__list>
<li class=menu__item>
<a class=menu__link href=/associazione/>
<span class=menu__text>Associazione</span>
</a>
</li>
<li class=menu__item>
<a class=menu__link href=/attivit%C3%A0/>
<span class=menu__text>Attività</span>
</a>
</li>
<li class=menu__item>
<a class=menu__link href=/calendario/>
<span class=menu__text>Calendario</span>
</a>
</li>
<li class=menu__item>
<a class=menu__link href=/contatti/>
<span class=menu__text>Contatti</span>
</a>
</li>
<li class=menu__item>
<a class=menu__link href=/linuxday/>
<span class=menu__text>Linux Day</span>
</a>
</li>
</ul>
</nav>
</div>
</header>
<div class="wrapper flex">
<div class=primary>
<main class=main role=main>
<article class=post>
<header class=post__header>
<h1 class=post__title>Arduracing</h1>
<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-01-21T20:48:01+01:00>21-01-2020</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/progetti/ rel=category>Progetti</a>
</span>
</div></div>
</header>
<figure class="post__thumbnail thumbnail">
<img class=thumbnail__image src=/thumb/arduracing.jpg alt=Arduracing>
</figure>
<div class="post__toc toc">
<div class=toc__title>Indice</div>
<div class=toc__menu>
<nav id=TableOfContents>
<ul>
<li><a href=#principio-di-funzionamento>Principio di funzionamento</a></li>
<li><a href=#casi-particolari>Casi particolari</a></li>
<li><a href=#hardware>Hardware</a></li>
<li><a href=#filtri-rc>Filtri RC</a></li>
<li><a href=#telaio>Telaio</a></li>
<li><a href=#circuito-di-prova>Circuito di prova</a></li>
<li><a href=#software>Software</a></li>
<li><a href=#messa-in-pista>Messa in pista</a></li>
<li><a href=#problemi>Problemi</a></li>
</ul>
</nav>
</div>
</div><div class="content post__content clearfix">
<p>Arduracing è un progetto che aspira alla creazione di una robot car in grado di muoversi autonomamente all’ interno di un circuito.</p>
<p>Il robot utilizza 4 sensori di distanza ad infrarossi per determinare la distanza dalle pareti laterali e frontali.
Attraverso questi dati è in gradi di estrapolare la distanza e l’angolo delle curve. Il robot è in grado di sterzare e viaggiare a velocità variabile in avanti ed indietro. Il telaio è realizzato con il Lego. Il progetto è stato presentato durante il Linux Day 2011 a Lucca ed ha dato risultati soddisfacenti, sono ovviamente stati individuati degli errori di progettazione che sono espressi nella sezione conclusioni.</p>
<h2 id=principio-di-funzionamento>Principio di funzionamento</h2>
<p>Il funzionamento si basa sul seguente schema geometrico: Posizionando due sensori di distanza paralleli alla vettura ai lati della stessa è possibile attraverso semplici formule goniometriche ricavare l’angolo di inclinazione della retta C, che non rappresenta altro che una linearizzazione del tratto di curva.</p>
<p>$$\alpha = (d1-d2/l)$$</p>
<p>Ovviamente avendo a disposizione le distanze d1 e d2 è possibile anche conoscere a che distanza si trova l’ostacolo oltre alla sua inclinazione.</p>
<p><img src=/img/ardualpha.jpg alt="Principio funzionamento Arduracing"></p>
<p>Questo tipo di approccio permette al robot di differenziarsi da un classico line-follower in quanto è in grado di conoscere in anticipo le curve e quanto siano più o meno strette. In questo modo è in grado di regolare la propria velocità o eseguire manovre correttive nel caso ad esempio, che si trovi sul lato della pista corrispondente all’interno curva.</p>
<h2 id=casi-particolari>Casi particolari</h2>
<p>Uno dei casi in cui l’algoritmo sopra espresso fallisce è espresso nella figura sottostante: In questo caso i due sensori “vedono” uno l’interno della pista e l’altro l’esterno. Sotto stimando l’angolo di sterzo necessario ad evitare l’interno curva.</p>
<p>Per ovviare a questo problema nell’esempio si calcola l’angolo utilizzando il sensore laterale destro ed il posteriore destro.</p>
<p><img src=/img/ardualpha2.jpg alt="Funzionamento interno curva"></p>
<p>Un altro caso problematico si manifesta quando la parete interna è quasi parallela all’auto: in questo frangente si utilizzano i sensori laterali per evitare che l’auto sia avvicini troppo. Un ulteriore raffinazione dell’algoritmo sviluppato valuta non solo la distanza laterale ma anche la velocità di avvicinamento ai bordi in modo da poter sfruttare maggiormente la pista.</p>
<h2 id=hardware>Hardware</h2>
<ul>
<li>1 x Arduino UNO</li>
<li>1 x Sparkfun Motor-Shield</li>
<li>4 x sensori distanza sharp</li>
<li>1 x servomotore</li>
<li>4 x resistenze</li>
<li>5 x condensatori</li>
<li>1 x modellino LEGO</li>
</ul>
<h2 id=filtri-rc>Filtri RC</h2>
<p>Una prima analisi dei sensori di distanza ha evidenziato un notevole rumore sul segnale in uscita, per questo abbiamo deciso di costruire dei semplici filtri passa-basso passivi per ridurre le perturbazioni con una frequenza superiore a quella di taglio. Inoltre è stato connesso in serie all’alimentazione dei sensori un condensatore elettrolitico al fine di evitare una tensione di alimentazione instabile.</p>
<p><img src=/img/sensori.jpg alt=sensori></p>
<h2 id=telaio>Telaio</h2>
<p>Il telaio rappresenta la parte più complessa dal punto di vista realizzativo pratico e come meglio presentato nelle conclusioni, anche il punto di maggior debolezza del robot. Per realizzarlo è stato utilizzato il LEGO e i vari componenti sono stati fissati a mezzo di colla a caldo. Durante la sua realizzazione si sono manifestati diversi problemi: i principali sono stati gli attriti degli ingranaggi che generavano una quantità notevole di energia dissipata e lo sterzo in cui erano presenti innumerevoli “giochi”.</p>
<p>Per risolvere questi due problemi siamo ricorsi ad un motore che comprendesse già un rapporto di riduzione e lo sterzo è stato quanto più semplificato, togliendo ad esempio il sistema di ammortizzatori, presente nella prima versione del robot.</p>
<p><img src=/img/sterzo.jpg alt=sterzo></p>
<h2 id=circuito-di-prova>Circuito di prova</h2>
<p>Il circuito è realizzato per gran-parte in cartone, la base è stata realizzata con fogli di 100×80 cm di spessore 3 mm, mentre le pareti sono realizzate con delle bande ritagliate alte circa 30 cm di cartoncino meno spesso. Al fine di rendere la struttura più resistente agli urti del robot sono stati costruiti con materiale plastico e colla a caldo dei pilastri all’esterno delle pareti come evidente in foto.</p>
<p><img src=/img/pista.jpg alt="Circuito di prova"></p>
<h2 id=software>Software</h2>
<p>La parte software è stata poco curata a causa dell’avvicinarsi dell’evento a cui dovevo presentare il progetto. In particolare non sono riuscito a sviluppare una funzione per “frenare” prima delle curve.</p>
<p>Le parti principali del codice verranno illustrate in una serie di articoli che gli dedicherò all’interno del blog.</p>
<p>Di seguito è riportato il sorgente utilizzato per la dimostrazione:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#099>#define sinistra 1
</span><span style=color:#099>#define destra 0
</span><span style=color:#099>#define avanti HIGH
</span><span style=color:#099>#define indietro LOW
</span><span style=color:#099>#define POT_MIN 110
</span><span style=color:#099>#define N_misure 15
</span><span style=color:#099>#define S 125
</span><span style=color:#099>#define D 35
</span><span style=color:#099>#define C 80
</span><span style=color:#099></span>Servo myservo;                  <span style=color:#09f;font-style:italic>// create servo object to control a servo
</span><span style=color:#09f;font-style:italic>// a maximum of eight servo objects can be created
</span><span style=color:#09f;font-style:italic></span><span style=color:#078;font-weight:700>int</span> pos <span style=color:#555>=</span> <span style=color:#f60>90</span>;
<span style=color:#078;font-weight:700>int</span> pwm_a <span style=color:#555>=</span> <span style=color:#f60>10</span>;                 <span style=color:#09f;font-style:italic>//PWM control for motor outputs 1 and 2 is on digital pin 10
</span><span style=color:#09f;font-style:italic></span><span style=color:#078;font-weight:700>int</span> pwm_b <span style=color:#555>=</span> <span style=color:#f60>11</span>;                 <span style=color:#09f;font-style:italic>//PWM control for motor outputs 3 and 4 is on digital pin 11
</span><span style=color:#09f;font-style:italic></span><span style=color:#078;font-weight:700>int</span> dir_a <span style=color:#555>=</span> <span style=color:#f60>12</span>;                 <span style=color:#09f;font-style:italic>//direction control for motor outputs 1 and 2 is on digital pin 12
</span><span style=color:#09f;font-style:italic></span><span style=color:#078;font-weight:700>int</span> dir_b <span style=color:#555>=</span> <span style=color:#f60>13</span>;                 <span style=color:#09f;font-style:italic>//direction control for motor outputs 3 and 4 is on digital pin 13
</span><span style=color:#09f;font-style:italic></span><span style=color:#078;font-weight:700>float</span> AS, PD, AD, PS;
<span style=color:#078;font-weight:700>int</span> dist_P_min, dist_P_max, dist_P_media, angolo_curva, dir_curva, inizio_curva;
<span style=color:#078;font-weight:700>int</span> dist_A_min, dist_A_max, dist_A_media, rapporto;
<span style=color:#078;font-weight:700>int</span> t;
<span style=color:#078;font-weight:700>int</span> blocco <span style=color:#555>=</span> <span style=color:#f60>0</span>;
<span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>setup</span>()
{
    <span style=color:#09f;font-style:italic>// initialize the serial communication:
</span><span style=color:#09f;font-style:italic></span>    Serial.begin(<span style=color:#f60>9600</span>);
    <span style=color:#09f;font-style:italic>// initialize servo and motor-shield
</span><span style=color:#09f;font-style:italic></span>    myservo.attach(<span style=color:#f60>9</span>);
    pinMode(pwm_b, OUTPUT);
    pinMode(dir_b, OUTPUT);
    <span style=color:#09f;font-style:italic>// seti initial value for the motor
</span><span style=color:#09f;font-style:italic></span>    digitalWrite(dir_b, HIGH);
    analogWrite(pwm_b, <span style=color:#f60>0</span>);
}
<span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>aggiorna</span>()
{
    <span style=color:#09f;font-style:italic>//vengono effettuate tutte le misure e ricalcolate le variabili
</span><span style=color:#09f;font-style:italic></span>    AS <span style=color:#555>=</span> <span style=color:#f60>0</span>;
    AD <span style=color:#555>=</span> <span style=color:#f60>0</span>;
    PS <span style=color:#555>=</span> <span style=color:#f60>0</span>;
    PD <span style=color:#555>=</span> <span style=color:#f60>0</span>;
    <span style=color:#078;font-weight:700>int</span> i <span style=color:#555>=</span> <span style=color:#f60>0</span>;
    <span style=color:#069;font-weight:700>for</span> (i <span style=color:#555>=</span> <span style=color:#f60>0</span>; i <span style=color:#555>&lt;</span> N_misure; i<span style=color:#555>++</span>) {
        AS <span style=color:#555>+=</span> <span style=color:#f60>2076.0</span> <span style=color:#555>/</span> (constrain(analogRead(A2), <span style=color:#f60>80</span>, <span style=color:#f60>530</span>) <span style=color:#555>-</span> <span style=color:#f60>11.0</span>);
        AD <span style=color:#555>+=</span> <span style=color:#f60>2076.0</span> <span style=color:#555>/</span> (constrain(analogRead(A4), <span style=color:#f60>80</span>, <span style=color:#f60>530</span>) <span style=color:#555>-</span> <span style=color:#f60>11.0</span>);
        PS <span style=color:#555>+=</span> <span style=color:#f60>9462.0</span> <span style=color:#555>/</span> (constrain(analogRead(A1), <span style=color:#f60>80</span>, <span style=color:#f60>550</span>) <span style=color:#555>-</span> <span style=color:#f60>16.92</span>);
        PD <span style=color:#555>+=</span> <span style=color:#f60>9462.0</span> <span style=color:#555>/</span> (constrain(analogRead(A3), <span style=color:#f60>80</span>, <span style=color:#f60>550</span>) <span style=color:#555>-</span> <span style=color:#f60>16.92</span>);
    }
    AS <span style=color:#555>/=</span> N_misure;
    AD <span style=color:#555>/=</span> N_misure;
    PS <span style=color:#555>/=</span> N_misure;
    PD <span style=color:#555>/=</span> N_misure;
    PD <span style=color:#555>+=</span> <span style=color:#f60>1.5</span>;
    PD <span style=color:#555>=</span> constrain(PD, <span style=color:#f60>0</span>, <span style=color:#f60>150</span>);
    dist_P_min <span style=color:#555>=</span> min(PD, PS);
    dist_P_max <span style=color:#555>=</span> max(PD, PS);
    dist_P_media <span style=color:#555>=</span> (PD <span style=color:#555>+</span> PS) <span style=color:#555>/</span> <span style=color:#f60>2</span>;
    dist_A_min <span style=color:#555>=</span> min(AD, AS);
    dist_A_max <span style=color:#555>=</span> max(AD, AS);
    dist_A_media <span style=color:#555>=</span> (AD <span style=color:#555>+</span> AS) <span style=color:#555>/</span> <span style=color:#f60>2</span>;
    <span style=color:#069;font-weight:700>if</span> ((PD <span style=color:#555>-</span> PS) <span style=color:#555>&gt;</span> <span style=color:#f60>0</span>)
        dir_curva <span style=color:#555>=</span> <span style=color:#f60>0</span>;
    <span style=color:#069;font-weight:700>else</span>
        dir_curva <span style=color:#555>=</span> <span style=color:#f60>1</span>;
    <span style=color:#078;font-weight:700>int</span> angolo_curva_c <span style=color:#555>=</span> <span style=color:#f60>9</span> <span style=color:#555>-</span> atan(abs(PD <span style=color:#555>-</span> PS) <span style=color:#555>/</span> <span style=color:#f60>15.5</span>) <span style=color:#555>*</span> (<span style=color:#f60>2</span> <span style=color:#555>/</span> <span style=color:#f60>3.14</span>) <span style=color:#555>*</span> <span style=color:#f60>9</span>;
    <span style=color:#078;font-weight:700>int</span> angolo_curva_d <span style=color:#555>=</span> <span style=color:#f60>9</span> <span style=color:#555>-</span> atan(abs(PD <span style=color:#555>-</span> <span style=color:#f60>18</span>) <span style=color:#555>/</span> AD) <span style=color:#555>*</span> (<span style=color:#f60>2</span> <span style=color:#555>/</span> <span style=color:#f60>3.14</span>) <span style=color:#555>*</span> <span style=color:#f60>9</span>;
    <span style=color:#078;font-weight:700>int</span> angolo_curva_s <span style=color:#555>=</span> <span style=color:#f60>9</span> <span style=color:#555>-</span> atan(abs(PS <span style=color:#555>-</span> <span style=color:#f60>18</span>) <span style=color:#555>/</span> AS) <span style=color:#555>*</span> (<span style=color:#f60>2</span> <span style=color:#555>/</span> <span style=color:#f60>3.14</span>) <span style=color:#555>*</span> <span style=color:#f60>9</span>;
    <span style=color:#09f;font-style:italic>//restituisce un valore da 0 a 10 per l&#39;angolo
</span><span style=color:#09f;font-style:italic></span>    <span style=color:#069;font-weight:700>if</span> (AS <span style=color:#555>&lt;</span> AD) {
        angolo_curva <span style=color:#555>=</span> max(angolo_curva_c, angolo_curva_s);
    } <span style=color:#069;font-weight:700>else</span> {
        angolo_curva <span style=color:#555>=</span> max(angolo_curva_d, angolo_curva_c);
    }
}
<span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>debug</span>()
{
    Serial.print(AS);
    Serial.print(<span style=color:#c30>&#34;|&#34;</span>);
    Serial.print(AD);
    Serial.print(<span style=color:#c30>&#34;|&#34;</span>);
    Serial.print(PS);
    Serial.print(<span style=color:#c30>&#34;|&#34;</span>);
    Serial.print(PD);
    Serial.print(<span style=color:#c30>&#34;|&#34;</span>);
    Serial.println(angolo_curva);
}
<span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>manuale</span>()
{
    <span style=color:#078;font-weight:700>int</span> a, b;
    <span style=color:#069;font-weight:700>if</span> (Serial.available() <span style=color:#555>&gt;</span> <span style=color:#f60>1</span>) {
        a <span style=color:#555>=</span> Serial.read();
        b <span style=color:#555>=</span> (Serial.read() <span style=color:#555>-</span> <span style=color:#f60>48</span>);
        <span style=color:#069;font-weight:700>switch</span> (a) {
            <span style=color:#069;font-weight:700>case</span> <span style=color:#c30>&#39;D&#39;</span><span style=color:#555>:</span>
                sterzo(destra, b);
                <span style=color:#069;font-weight:700>break</span>;
            <span style=color:#069;font-weight:700>case</span> <span style=color:#c30>&#39;S&#39;</span><span style=color:#555>:</span>
                sterzo(sinistra, b);
                <span style=color:#069;font-weight:700>break</span>;
            <span style=color:#069;font-weight:700>case</span> <span style=color:#c30>&#39;A&#39;</span><span style=color:#555>:</span>
                motore(avanti, b, <span style=color:#f60>0</span>);
                <span style=color:#069;font-weight:700>break</span>;
            <span style=color:#069;font-weight:700>case</span> <span style=color:#c30>&#39;R&#39;</span><span style=color:#555>:</span>
                motore(indietro, b, <span style=color:#f60>0</span>);
                <span style=color:#069;font-weight:700>break</span>;
        }
    }
}
<span style=color:#078;font-weight:700>int</span> <span style=color:#c0f>stato</span>()
{
    <span style=color:#09f;font-style:italic>//la funzione ritorna lo stato della vettura: 0 rettilineo, 1 curva, 2 collisione
</span><span style=color:#09f;font-style:italic></span>    <span style=color:#069;font-weight:700>if</span> (dist_P_min <span style=color:#555>&lt;</span> <span style=color:#f60>19</span> <span style=color:#555>||</span> dist_A_min <span style=color:#555>&lt;</span> <span style=color:#f60>5</span>) {
        blocco<span style=color:#555>++</span>;
    } <span style=color:#069;font-weight:700>else</span>
        blocco <span style=color:#555>=</span> <span style=color:#f60>0</span>;
    <span style=color:#069;font-weight:700>if</span> (blocco <span style=color:#555>&gt;</span> <span style=color:#f60>25</span>)
        <span style=color:#069;font-weight:700>return</span> <span style=color:#f60>2</span>;
    <span style=color:#069;font-weight:700>if</span> (dist_P_min <span style=color:#555>&gt;</span> <span style=color:#f60>35</span>)
        <span style=color:#069;font-weight:700>return</span> <span style=color:#f60>0</span>;
    <span style=color:#069;font-weight:700>else</span>
        <span style=color:#069;font-weight:700>return</span> <span style=color:#f60>1</span>;
}
<span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>motore</span>(boolean dir, <span style=color:#078;font-weight:700>int</span> potenza, <span style=color:#078;font-weight:700>int</span> angolo)
{
    <span style=color:#09f;font-style:italic>// la funzione compensa il maggior sforzo richiesto al motore con ruote sterzate e fissa il minimo della potenza
</span><span style=color:#09f;font-style:italic></span>    <span style=color:#09f;font-style:italic>// la potenza deve avere un valore intero tra 0 e 10
</span><span style=color:#09f;font-style:italic></span>    potenza <span style=color:#555>=</span> constrain(potenza, <span style=color:#f60>0</span>, <span style=color:#f60>10</span>);
    <span style=color:#069;font-weight:700>if</span> (potenza <span style=color:#555>!=</span> <span style=color:#f60>0</span>)
        potenza <span style=color:#555>=</span>
            constrain(map
                    (potenza <span style=color:#555>+</span> angolo <span style=color:#555>/</span> <span style=color:#f60>2</span> <span style=color:#555>+</span> <span style=color:#f60>1</span>, <span style=color:#f60>1</span>, <span style=color:#f60>10</span>, POT_MIN, <span style=color:#f60>254</span>),
                    POT_MIN, <span style=color:#f60>214</span>);
    digitalWrite(dir_b, dir);
    analogWrite(pwm_b, potenza);
    <span style=color:#09f;font-style:italic>//analogWrite(pwm_b, 0);
</span><span style=color:#09f;font-style:italic></span>    <span style=color:#09f;font-style:italic>//Serial.println(dir);
</span><span style=color:#09f;font-style:italic></span>}
<span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>sterzo</span>(<span style=color:#078;font-weight:700>int</span> dir, <span style=color:#078;font-weight:700>int</span> angolo)
{
    <span style=color:#078;font-weight:700>int</span> a <span style=color:#555>=</span> <span style=color:#f60>0</span>;
    <span style=color:#09f;font-style:italic>// la funzione richiede in ingresso la direzione e l&#39;angolo di sterzata
</span><span style=color:#09f;font-style:italic></span>    <span style=color:#09f;font-style:italic>// l&#39;angolo deve avere un valore tra 0 e 10
</span><span style=color:#09f;font-style:italic></span>    angolo <span style=color:#555>=</span> constrain(angolo, <span style=color:#f60>0</span>, <span style=color:#f60>10</span>);
    <span style=color:#069;font-weight:700>if</span> (dir <span style=color:#555>==</span> sinistra)
        a <span style=color:#555>=</span> map(angolo, <span style=color:#f60>0</span>, <span style=color:#f60>10</span>, C, S);
    <span style=color:#069;font-weight:700>if</span> (dir <span style=color:#555>==</span> destra)
        a <span style=color:#555>=</span> map(angolo, <span style=color:#f60>0</span>, <span style=color:#f60>10</span>, C, D);
    myservo.write(a);
}
<span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>sposta</span>(<span style=color:#078;font-weight:700>int</span> dir, <span style=color:#078;font-weight:700>int</span> potenza, <span style=color:#078;font-weight:700>int</span> tempo)
{
    motore(avanti, potenza, <span style=color:#f60>4</span>);
    <span style=color:#069;font-weight:700>if</span> (dir <span style=color:#555>==</span> sinistra) {
        sterzo(sinistra, <span style=color:#f60>4</span>);
        delay(tempo);
        sterzo(destra, <span style=color:#f60>4</span>);
        delay(tempo);
        sterzo(sinistra, <span style=color:#f60>0</span>);
    }
    <span style=color:#069;font-weight:700>if</span> (dir <span style=color:#555>==</span> destra) {
        sterzo(destra, <span style=color:#f60>4</span>);
        delay(tempo);
        sterzo(sinistra, <span style=color:#f60>4</span>);
        delay(tempo);
        sterzo(sinistra, <span style=color:#f60>0</span>);
    }
}

<span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>loop</span>()
{
    <span style=color:#078;font-weight:700>int</span> x;
    aggiorna();
    <span style=color:#078;font-weight:700>float</span> V_AS, V_AD;
    V_AS <span style=color:#555>=</span> AS;
    V_AD <span style=color:#555>=</span> AD;
    <span style=color:#069;font-weight:700>if</span> (dist_P_min <span style=color:#555>&gt;</span> <span style=color:#f60>60</span>) {
        delay(<span style=color:#f60>20</span>);
        aggiorna();
        <span style=color:#069;font-weight:700>if</span> (AD <span style=color:#555>&gt;</span> V_AD <span style=color:#555>-</span> <span style=color:#f60>0.2</span>) {
            sterzo(destra, (AD <span style=color:#555>-</span> V_AD) <span style=color:#555>*</span> <span style=color:#f60>5</span>);
            delay(<span style=color:#f60>20</span>);
        }
        <span style=color:#069;font-weight:700>if</span> (AS <span style=color:#555>&gt;</span> V_AS <span style=color:#555>-</span> <span style=color:#f60>0.2</span>) {
            sterzo(sinistra, (AS <span style=color:#555>-</span> V_AS) <span style=color:#555>*</span> <span style=color:#f60>5</span>);
            delay(<span style=color:#f60>20</span>);
        }
    }
    <span style=color:#069;font-weight:700>switch</span> (stato()) {
        <span style=color:#069;font-weight:700>case</span> <span style=color:#f60>0</span><span style=color:#555>:</span>
            motore(avanti, map(pow(dist_P_min <span style=color:#555>/</span> <span style=color:#f60>10</span>, <span style=color:#f60>2</span>), <span style=color:#f60>0</span>, <span style=color:#f60>200</span>, <span style=color:#f60>1</span>, <span style=color:#f60>10</span>), <span style=color:#f60>0</span>);
            <span style=color:#069;font-weight:700>if</span> (AS <span style=color:#555>&lt;</span> <span style=color:#f60>6</span>) {
                sterzo(destra, <span style=color:#f60>5</span>);
                <span style=color:#069;font-weight:700>break</span>;
            }
            <span style=color:#069;font-weight:700>if</span> (AD <span style=color:#555>&lt;</span> <span style=color:#f60>6</span>) {
                sterzo(sinistra, <span style=color:#f60>5</span>);
                <span style=color:#069;font-weight:700>break</span>;
            }
            <span style=color:#069;font-weight:700>if</span> (AS <span style=color:#555>&lt;</span> <span style=color:#f60>7</span>) {
                sterzo(destra, <span style=color:#f60>3</span>);
                <span style=color:#069;font-weight:700>break</span>;
            }
            <span style=color:#069;font-weight:700>if</span> (AD <span style=color:#555>&lt;</span> <span style=color:#f60>7</span>) {
                sterzo(sinistra, <span style=color:#f60>3</span>);
                <span style=color:#069;font-weight:700>break</span>;
            }
            <span style=color:#069;font-weight:700>if</span> (AS <span style=color:#555>&lt;</span> <span style=color:#f60>8</span>) {
                sterzo(destra, <span style=color:#f60>2</span>);
                <span style=color:#069;font-weight:700>break</span>;
            }
            <span style=color:#069;font-weight:700>if</span> (AD <span style=color:#555>&lt;</span> <span style=color:#f60>8</span>) {
                sterzo(sinistra, <span style=color:#f60>2</span>);
                <span style=color:#069;font-weight:700>break</span>;
            }
            <span style=color:#069;font-weight:700>if</span> (V_AS <span style=color:#555>&gt;</span> <span style=color:#f60>14</span> <span style=color:#555>&amp;&amp;</span> dir_curva <span style=color:#555>==</span> destra <span style=color:#555>&amp;&amp;</span> angolo_curva <span style=color:#555>&gt;</span> <span style=color:#f60>5</span>
                    <span style=color:#555>&amp;&amp;</span> dist_P_min <span style=color:#555>&gt;</span> <span style=color:#f60>60</span>)
                sposta(sinistra, <span style=color:#f60>1</span>, <span style=color:#f60>80</span>);
            <span style=color:#069;font-weight:700>if</span> (V_AD <span style=color:#555>&gt;</span> <span style=color:#f60>14</span> <span style=color:#555>&amp;&amp;</span> dir_curva <span style=color:#555>==</span> sinistra <span style=color:#555>&amp;&amp;</span> angolo_curva <span style=color:#555>&gt;</span> <span style=color:#f60>5</span>
                    <span style=color:#555>&amp;&amp;</span> dist_P_min <span style=color:#555>&gt;</span> <span style=color:#f60>60</span>)
                sposta(destra, <span style=color:#f60>1</span>, <span style=color:#f60>80</span>);
            sterzo(sinistra, <span style=color:#f60>0</span>);
            <span style=color:#069;font-weight:700>break</span>;
        <span style=color:#069;font-weight:700>case</span> <span style=color:#f60>1</span><span style=color:#555>:</span>
            <span style=color:#09f;font-style:italic>//curva
</span><span style=color:#09f;font-style:italic></span>            <span style=color:#09f;font-style:italic>//inizio_curva=((10-angolo_curva)*7)+5;
</span><span style=color:#09f;font-style:italic></span>            <span style=color:#069;font-weight:700>if</span> ((dir_curva <span style=color:#555>==</span> destra <span style=color:#555>&amp;&amp;</span> AS <span style=color:#555>&lt;</span> <span style=color:#f60>9</span>)
                    <span style=color:#555>||</span> (dir_curva <span style=color:#555>==</span> sinistra <span style=color:#555>&amp;&amp;</span> AD <span style=color:#555>&lt;</span> <span style=color:#f60>9</span>) <span style=color:#555>||</span> (dist_P_media <span style=color:#555>&lt;</span> <span style=color:#f60>41</span>)
                    <span style=color:#555>||</span> (dir_curva <span style=color:#555>==</span> destra <span style=color:#555>&amp;&amp;</span> PS <span style=color:#555>&lt;</span> <span style=color:#f60>27</span>)
                    <span style=color:#555>||</span> (dir_curva <span style=color:#555>==</span> sinistra <span style=color:#555>&amp;&amp;</span> PD <span style=color:#555>&lt;</span> <span style=color:#f60>27</span>)) {
                <span style=color:#069;font-weight:700>if</span> (dist_P_media <span style=color:#555>&gt;</span> <span style=color:#f60>25</span>) {
                    sterzo(dir_curva, angolo_curva);
                    motore(avanti,
                            constrain((dist_P_min <span style=color:#555>/</span> <span style=color:#f60>30</span>) <span style=color:#555>-</span>
                                angolo_curva <span style=color:#555>/</span> <span style=color:#f60>3</span>, <span style=color:#f60>1</span>, <span style=color:#f60>10</span>),
                            angolo_curva);
                } <span style=color:#069;font-weight:700>else</span> {
                    sterzo(dir_curva, <span style=color:#f60>10</span>);
                    motore(avanti, <span style=color:#f60>1</span>, <span style=color:#f60>10</span>);
                }
            } <span style=color:#069;font-weight:700>else</span> {
                sterzo(sinistra, <span style=color:#f60>0</span>);
            }
            <span style=color:#069;font-weight:700>break</span>;
        <span style=color:#069;font-weight:700>case</span> <span style=color:#f60>2</span><span style=color:#555>:</span>
            <span style=color:#09f;font-style:italic>//blocco
</span><span style=color:#09f;font-style:italic></span>            motore(indietro, <span style=color:#f60>1</span>, <span style=color:#f60>10</span>);
            delay(<span style=color:#f60>30</span>);
            <span style=color:#069;font-weight:700>if</span> (dir_curva <span style=color:#555>==</span> sinistra)
                sterzo(destra, <span style=color:#f60>10</span>);
            <span style=color:#069;font-weight:700>if</span> (dir_curva <span style=color:#555>==</span> destra)
                sterzo(sinistra, <span style=color:#f60>10</span>);
            <span style=color:#069;font-weight:700>while</span> ((dist_P_min <span style=color:#555>&lt;</span> <span style=color:#f60>19</span>) <span style=color:#555>||</span> (dist_A_min <span style=color:#555>&lt;</span> <span style=color:#f60>6</span>)) {
                aggiorna();
            }
            sterzo(sinistra, <span style=color:#f60>0</span>);
            motore(avanti, <span style=color:#f60>1</span>, <span style=color:#f60>0</span>);
            <span style=color:#069;font-weight:700>break</span>;
    }
}
</code></pre></div><h2 id=messa-in-pista>Messa in pista</h2>
<div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden>
<iframe src=https://www.youtube.com/embed/IuIp-CHJQyI style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe>
</div>
<h2 id=problemi>Problemi</h2>
<p>Durante la fase di test si sono evidenziati alcuni problemi che vado ad elencare in ordine di gravità.</p>
<ol>
<li>
<p><strong>Telaio poco rigido</strong><br>
Il telaio si è rivelato troppo poco rigido e durante i vari test ci si è spesso accorti che l’allineamento dei sensori non era corretto.</p>
</li>
<li>
<p><strong>Sensori</strong><br>
Nonostante i filtri applicato il rumore sui sensori è ancora presente, una possibile soluzione sarebbe quella di comprare sensori di qualità maggiore.</p>
</li>
<li>
<p><strong>Trasmissione</strong><br>
Pur avendo utilizzato al minimo il numero di ingranaggi LEGO, la trasmissione potrebbe essere migliorata utilizzando ingranaggi metallici ed inserito anche un differenziale.</p>
</li>
</ol>
</div>
<footer class=post__footer>
<div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg>
<ul class=tags__list>
<li class=tags__item>
<a class="tags__link btn" href=/tags/arduino/ rel=tag>arduino</a>
</li>
</ul>
</div>
</footer>
</article>
</main>
<nav class="pager flex">
<div class="pager__item pager__item--prev">
<a class=pager__link href=/post/i-gestori-di-pacchetti/ rel=prev>
<span class=pager__subtitle>«&#8201;Precedente</span>
<p class=pager__title>I gestori di pacchetti</p>
</a>
</div>
<div class="pager__item pager__item--next">
<a class=pager__link href=/post/serateatema2020/ rel=next>
<span class=pager__subtitle>Prossimo&#8201;»</span>
<p class=pager__title>Serate a tema 2020</p>
</a>
</div>
</nav>
</div>
</div>
<footer class=footer>
<div class="container footer__container flex">
<div class=footer__copyright>
&copy; 2022 Luccalug CC.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span>
</div>
</div>
</footer>
</div>
<script async defer src=/js/menu.js></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>